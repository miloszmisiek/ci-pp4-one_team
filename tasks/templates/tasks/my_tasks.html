{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid profile-home-container">
    <div class="row text-center">
        <div class="col-12 mx-auto p-2 mt-4 d-flex justify-content-center align-items-center">
            <h1 class="">
                {{ request.user.first_name}}'s Dashboard<br> ({{ request.user.get_rank_display}})
            </h1>
        </div>
    </div>
    <div class="row text-center mt-md-4">
        <div class="col-12 col-md-4 p-2 mx-auto mt-4 m-md-auto d-flex flex-column justify-content-center align-items-center">
            <div class="users-forms-container p-2 align-self-center jus">
                <h3 class="d-flex w-100 py-1 justify-content-center align-self-center">Your Account</h3>
                <div class="profile-buttons w-100 py-1 d-flex justify-content-around align-items-center">
                    <a id="edit-profile-anchor" href="{% url 'edit_profile' request.user.id %}">
                        <button type="button" class="btn btn-warning">Edit</button>
                    </a>
                    <a id="delete-profile-anchor" class="confirm-delete" href="{% url 'delete_profile' request.user.id %}">
                        <button type="button" class="btn btn-danger">Delete</button>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-4 p-2 mx-auto mt-4 m-md-auto h5">
            <form action="" method="get" id="my_form">
                <label for="months"><strong>Select Month:</strong></label>
                <select onchange="submit_form('my_form')" class="d-block mx-auto" name="months" id="months">
                    <option disabled>Select Month</option>
                    <option value='1'>Janaury</option>
                    <option value='2'>February</option>
                    <option value='3'>March</option>
                    <option value='4'>April</option>
                    <option value='5'>May</option>
                    <option value='6'>June</option>
                    <option value='7'>July</option>
                    <option value='8'>August</option>
                    <option value='9'>September</option>
                    <option value='10'>October</option>
                    <option value='11'>November</option>
                    <option value='12'>December</option>
                </select>
            </form>
        </div>
        <div class="col-12 col-md-4 p-2 h5 mx-auto mt-4 m-md-auto">
            <div class="mw-50 w-100 ml-auto"><strong>Today is:</strong>
                <div id="date"></div>
            </div>
        </div>
    </div>
    {% if user.rank is not 3 %}
    <div class="row text-right">
        <div class="col-12 mx-auto col-lg-4 mt-4 ml-lg-auto mr-lg-0 text-center">
            <div class="add-task-btn">
                <a href="{% url 'add_task' %}">Add Task +</a>
            </div>
        </div>
    </div>
    {% endif %}
    <div class="row">
        <div class="col">
            <table class="mx-auto mt-5" id="home-table">
                <thead>
                    <tr class="table-head">
                        <th onclick="sortTable(0)">ID</th>
                        <th onclick="sortTable(1)">Status</th>
                        <th onclick="sortTable(2)">Owner</th>
                        <th onclick="sortTable(3)">Priority</th>
                        <th onclick="sortTable(4)">Title</th>
                        <!-- <th>Start Date</th> -->
                        <th onclick="sortTable(5)" id="end-date">End Date
                            <i class="fas fa-caret-up" id="remove-this"></i>
                        </th>
                        <!-- <th>Duration</th> -->
                        <th onclick="sortTable(6)">Approval</th>
                        <th id="details">Details</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                    <tr class="{% if task.approval_status == 1 %} 
                    approval-styling {% endif %}
                    {% if task.status == 1 %} clr-green {% endif %}
                    {% if task.is_past_due.0 %}
                    clr-red .font-weight-bold
                    {% endif %}
                    ">
                        <td>{{ forloop.counter }}</td>
                        <td {% if task.assigned_to == request.user and request.user.rank == 2 or request.user.rank == 1 or request.user.is_superuser %} class="progress-status-cell p-md-0 {% if task.status == 1 %} task-completed {% else %} task-inprogress{% endif %}" data-toggle="modal"
                        data-target="#completeModal" data-title="{{ task.title }}"
                        data-task-status="{{ task.status }}" data-assigned="{{ task.assigned_to }}"
                        data-id="{{ task.id }}" data-username="{{ request.user.username }}"
                        data-user-rank="{{ request.user.rank }}" {% else %} class="p-md-0" {% endif %}>
                        {% if task.status == 1 %} <i class="fas fa-check-circle"></i> {% else %} {{ task.get_status_display }} {% endif %}
                        </td>
                        <td id="task-assigned"><span class="assigned-rank">{{ task.assigned_to.get_rank_display }}</span><span class="assigned-username">{{ task.assigned_to }}</span></td>
                        <td>{{ task.get_priority_display }}</td>
                        <td class="tasks-titles">{{ task.title }}</td>
                        <!-- <td>{{ task.created_on | date:"d F Y" }}</td> -->
                        <td>{% if task.is_past_due.0 %}<i class="fas fa-exclamation pr-1"></i>{% elif task.is_past_due.1 <= 2 %} <i class="fas fa-exclamation-triangle clr-gold pr-1"></i> {% endif %} {{ task.end_date | date:"d F Y" }}</td>
                        <td>
                        {% if request.user.is_superuser or request.user.rank == 1 and task.priority != 0 %}
                            {% if task.approval_status == 1 %}
                                    <a href="{% url 'approve' task.id %}">
                                        <button type="button" class="btn btn-success approve-btn" data-id="{{ task.id }}"
                                            data-approval="{{ task.approval_status }}">Approve</button>
                                    </a>
                                    <input type="hidden" name="approve-request" />
                            {% else %}
                                {{ task.get_approval_status_display }}
                            {% endif %}
                        {% else %}
                            {% if task.approval_status == 1 %} <i class="fas fa-clock"></i> {% endif %}
                            {{ task.get_approval_status_display }}
                        {% endif %}
                        </td>
                        <td>
                            <button type="button" class="btn btn-primary" data-toggle="modal"
                                data-target="#exampleModal" data-title="{{ task.title }}"
                                data-description="{{ task.description }}" data-assigned="{{ task.assigned_to }}"
                                data-id="{{ task.id }}" data-username="{{ request.user.username }}"
                                data-user-rank="{{ request.user.rank }}">Open</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="row text-right clear-completed-row">
        <div class="col-12 mx-auto col-sm-4 my-4 ml-sm-auto mr-sm-0 pr-0 text-center">
            <form action="" method="post">
                {% csrf_token %}
                <button class="add-task-btn mr-sm-0 border-0" type="submit">Hide Completed</button>
                <input type="hidden" name="clear-completed" />
            </form>
        </div>
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">
                </div>
                {% if user.rank != 3 %}
                <div class="description-buttons d-flex justify-content-around p-2">
                    <a id="edit-task-anchor" href="#">
                        <button type="button" class="btn btn-warning">Edit Task</button>
                    </a>
                    <a id="delete-task-anchor" class="confirm-delete" href="">
                        <button type="button" class="btn btn-danger">Delete Task</button>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="modal fade" id="completeModal" tabindex="-1" role="dialog" aria-labelledby="completeModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="completeModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-center">
            </div>
            <div class="description-buttons d-flex justify-content-around p-2">
                <a id="yes-anchor" href="#">
                    <button type="button" class="btn btn-warning">Yes</button>
                </a>
                <a id="no-anchor" href="">
                    <button type="button" class="btn btn-danger">No</button>
                </a>
            </div>
        </div>
    </div>
</div>
</div>

{% endblock %}

{% block postloadjs %}
<script src="{% static 'js/profile_home.js' %}"></script>
{% endblock%}